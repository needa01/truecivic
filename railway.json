{
  "$schema": "https://railway.app/schema.json",
  "build": {
    "builder": "dockerfile",
    "dockerfile": "railway-worker.dockerfile"
  },
  "deploy": {
    "startCommand": "prefect worker start --pool default-agent-pool --name railway-worker",
    "restartPolicyMaxRetries": 5,
    "restartPolicyWindowSeconds": 60
  },
  "services": {
    "prefect-worker": {
      "name": "Prefect Worker",
      "description": "Executes ETL flows for bill, vote, committee, and debate data ingestion",
      "serviceType": "worker",
      "dockerfile": "railway-worker.dockerfile",
      "rootDirectory": "/app",
      "environment": {
        "PREFECT_API_URL": {
          "reference": "${{Prefect_Server.PREFECT_API_URL}}",
          "description": "URL of Prefect Cloud instance"
        },
        "DATABASE_PUBLIC_URL": {
          "reference": "${{PostgreSQL.DATABASE_PUBLIC_URL}}",
          "description": "PostgreSQL connection URL with pgvector"
        },
        "REDIS_URL": {
          "reference": "${{Redis.REDIS_URL}}",
          "description": "Redis URL for Prefect result backend"
        },
        "PYTHONUNBUFFERED": {
          "value": "1",
          "description": "Enable unbuffered Python output for logs"
        }
      },
      "resources": {
        "cpu": "0.5",
        "memory": "1G",
        "maxConcurrency": 1
      },
      "networking": {
        "exposePort": false
      }
    }
  }
}
